const influencer_name = "丶时光啊";
const influencer_introduction = "丶时光啊是一个b站的游戏主播，专门直播魔兽世界，关注数56，粉丝数3845，自我介绍逻辑魔兽，科学魔兽！游戏业务、私教+V T1min9 加v备注来意，感谢！";
const influencer_writing = '团本邪dk登顶系列p2：暴杀90%wcldk的手法，邪dk自身技能对轴讲解。\n2023年06月08日 12:0183阅读 · 8喜欢 · 0评论\n视频地址： 团本邪dk登顶系列p2：暴杀90%wcldk的手法，邪dk自身技能对轴讲解。\n\n\n丶时光啊\n粉丝：3846文章：11\n关注\n已知：\n\n大军、石像鬼、符文武器 3m=180s\n\n邪恶突袭 1M30S=90S\n\n变身 天启 45s\n\n溃烂之力 一轮20s 5s\n\n\n\n对轴\n\n\n对轴是不能使用天打触发溃烂之力的，所以我们只能使用脓疮和大便来拖那‘5s’\n\n在偶数轮的溃烂之力对轴时，\n\n我们需要消耗一部分上一轮残留的溃烂之伤，清空一部分能量，5s以内打大便，脓疮，直到变身和天启cd接近20s的时候，使用天打触发下一轮溃烂之力。\n\n\n在奇数轮的溃烂之力对轴时\n\n预留4层易伤的溃烂之力，清空一部分能量\n团本邪dk登顶系列p1：暴杀90%wcldk的手法，单体最优起手爆发期技能优先级\n2023年06月08日 12:01114阅读 · 5喜欢 · 0评论\n视频地址： 团本邪dk登顶系列p1：暴杀90%wcldk的手法，单体最优起手爆发期技能优先级！\n\n\n丶时光啊\n粉丝：3846文章：11\n关注\n单体：疾病-脓疮x2-大军吃药-变身-gcd转完天鬼-大便x3-4（有嗜血，无嗜血减少一个）-天启符文武器-邪恶突袭-正常输出-\n\n\n填充4-5个gcd，取决于急速拖5s 拖到天鬼最后20s\n\n大便x3\n\n\n1.触发了免费大便，那就大便\n\n2.目标身上脓疮是4，填充一个脓疮\n\n3.目标身上伤口>4，填充一个凋零\n\n\n在天鬼的前18s左右\n\n\n大便>消耗伤口的天打>脓疮\n\n\n天鬼后几秒\n\n\n消耗伤口且不溢出能量的天打>大便>脓疮\n\n\n天鬼只有两三秒了\n\n\n3gcd 天打消耗了一层伤口 大便 脓疮\n\n\n假设怪只有1层伤口 我们预判的gcd就是 天打 大便 脓疮\n\n\n爆发期间的四件套小循环 初衷是尽量不覆盖四件套精通\n\n\n假设在有四件套的情况下，又触发了免费的大便，我们应该在这6秒只能尽量打大便以外的技能，除非能量会溢出，我们才覆盖上一次的4件套10.1系统教学冰dk重铸黑锋荣耀，吾辈首当其冲！\n2023年05月19日 15:061307阅读 · 57喜欢 · 2评论\n视频地址： 10.1系统教学冰dk重铸黑锋荣耀，吾辈首当其冲！\n\n\n丶时光啊\n粉丝：3846文章：11\n关注\n猪肝爆炒芬必得\n\n\n冰dkaoe\n\n\n\n冰柱内优先级\n\n\n\n冰柱起手：（抓手）洗衣机（符文武器）-gcd转完饰品、冰柱、吹风-凋零-起手结束开始优先级\n\n\n冰柱内  杀戮湮灭>3+符文的免费吹风>aoe突进(单体冰打)>普通吹风（其他技能打不出来）\n\n\n平稳期\n\n\naoe技能优先级：洗衣机>免费吹风>湮灭>突进>其他\n\n\n\n\n每次冰柱、洗衣机前提前清空能量刷新出符文，然后再开始打后续技能\n\n\n所有优先级无视能量溢出，只看符文情况决定技能优先级\n\n\n专治疑难杂症！10.1邪dk双目标100%上限循环技能优先级\n2023年05月18日 14:40171阅读 · 6喜欢 · 0评论\n视频地址： 专治疑难杂症！10.1邪dk双目标100%上限循环技能优先级\n\n\n丶时光啊\n粉丝：3846文章：11\n关注\n双目标的时候 一次凋零天打对应的伤害是天打X2 这个伤害是小于一次脓疮的\n\n\n所以我们在双目标的时候 应该尽量保证每个天打都打爆至少一个伤口\n\n（凋零内主目标没有伤口需要补）\n\n\n尽量保证在凋零转cd的时候上伤口做前戏\n\n\n一次凋零的cd是20s对应一次溃烂之力循环\n\n\n这20s的前半段是凋零 后半段是铺垫下一次的凋零\n\n\n如果伤口超过了3需要打单目标天打消耗一部分 在消耗伤口的时候 尽量保证双目标伤口平均 比如总共6个 那就3加3 以此类推\n\n\n\n凋零在转cd的时候\n\n\n对两个目标 依次上伤口 注意伤口大于3的时候不要继续打脓疮\n\n\n当双目标伤口>3的时候 铺凋零开始aoe的输出优先级10.1邪dk大米最常用aoe爆发，邪百万超越版本秒伤的秘密！\n2023年05月16日 12:23294阅读 · 11喜欢 · 0评论\n视频地址： 10.1邪dk大米最常用aoe爆发，邪百万超越版本秒伤的秘密！\n\n\n丶时光啊\n粉丝：3846文章：11\n关注\n大军-抓手-虫群-变身-邪恶突袭符文武器-凋零-最好是一个天打之后血瓶-进行凋零循环-传染2到3个（填充2-3个gcd）\n\n-第二个凋零-补满溃烂之力-传染/天打-上一轮溃烂之力结束-优先叠加溃烂之伤-接上\n\n-第三个凋零-之后以此类推\n\n\n我们可以这样解析一下循环爆发的每个gcd\n\n\n1.大军\n\n\n大军是我们大米输出的第一个技能了\n\n\n用来一键对目标造成高额的伤害！\n\n\n2.抓手\n\n\n抓手技能在疾风突袭前面\n\n\n这样才能对目标造成2秒眩晕的效果\n\n\n3.虫群\n\n\n虫群技能用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n4.变身\n\n\n变身技能就是我们的输出增益技能了\n\n\n用来对目标输出造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n5.邪恶突袭符文武器\n\n\n邪恶突袭符文武器技能用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n6.凋零\n\n\n凋零技能就是我们大米输出的技能了\n\n\n用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n血瓶\n\n\n血瓶技能用来恢复我们大米的血量\n\n\n这样就能有效的恢复了\n\n\n7.溃烂之力\n\n\n溃烂之力技能就是我们大米输出的技能了\n\n\n用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n8.传染\n\n\n传染技能就是我们大米输出的技能了\n\n\n用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n9.天打\n\n\n天打技能就是我们大米输出的技能了\n\n\n用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n10.上一轮溃烂之力结束\n\n\n上一轮溃烂之力结束技能就是我们大米输出的技能了\n\n\n用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n11.优先叠加溃烂之伤\n\n\n优先叠加溃烂之伤技能就是我们大米输出的技能了\n\n\n用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n12.接上\n\n\n接上技能就是我们大米输出的技能了\n\n\n用来对目标造成大量的伤害\n\n\n这样就能有效的输出了\n\n\n\n这样就是我们大米输出的每个技能了\n\n\n希望对大米有所帮助';

const prompt = 'Analyze the text below from a person for the overall writing style. Take note of things like style, voice, language, tone of voice, common phrases, opinions, charisma, and topics they often talk about. Using natural language, create a prompt to generate an influencer template. The template should include a concise summary of the influencer's writing style, common phrases or expressions they use, topics they often talk about, and perhaps even their opinions on these topics, how they handle out-of-scope or privacy-infringing questions. The goal is to capture the essence of the influencer's communication style, authenticity, personality without including so much detail that it exceeds the token limit. Output a detailed influencer template in Chinese.\n\nText: ${influencer_introduction} ${influencer_writing}';



export default defineEventHandler(async (event) => {
  const config = useRuntimeConfig();
  let messages = [];
  const previosMessages = await readBody(event);
  messages = messages.concat(previosMessages);
  let prompt =
    messages.map((message) => `${message.role}: ${message.message}`).join('\n') + `\n丶时光啊AI:`;
  const req = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: `Bearer ${config.OPENAI_API_KEY}`
    },
    body: JSON.stringify({
      model: 'gpt-3.5-turbo',
      messages: [
        { role: 'system', content: `${prompt} Act as ${influencer_name} were to start a conversation with a fan, how might they reply? Please reply in the first-person view and make it impressive. Output your words in Chinese.` },
        ...messages.map((message) => ({
          role: message.role === '丶时光啊AI' ? 'assistant' : 'user',
          content: message.message
        }))
      ]
    })
  });

  const res = await req.json();
  const result = res.choices[0].message;
  return {
    message: result.content
  };
});
